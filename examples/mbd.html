<!DOCTYPE html>
<html>
  <head>
    <title>Stedman Pricker Test Page</title>
    <style type="text/css">
      div {
        margin: 10px 0px 0px 25px;
      }

      #sixends {
        font-family: "Courier New", "Courier", "monospace";
        font-size: 12pt;
      }

      #sixends, #controls, #touch {
        float: left;
      }

      .oddCall {
        cursor: pointer;
        background-color: #F0F0F8;
      }

      .evenCall {
        cursor: pointer;
        background-color: #E2E2F0;
      }
    </style>
    <script type="text/javascript" src="../build/stedman-pricker.js"></script>
  </head>
  <body>
    <div id="sixends"></div>
    <div id="controls">
      <div>
        <label for="stage">Number of bells:</label>
        <select id="stage" onchange="setStage()"></select>
      </div>
      <div>
        Course from rounds:
        <div id="callingFromRounds"></div>
      </div>
      <div>
        From current start row:
        <div id="calling"></div>
      </div>
      <div>
        <form onsubmit="return false">
          <label for="initialRow">Starting row:</label>
          <input type="text" id="initialRow" size="15" maxLength="15" />
          <button onclick="setInitialRow()">Set</button>
          <button onclick="resetInitialRow()">Reset</button>
        </form>
      </div>
      <div>
        <form onsubmit="return false">
          <label for="courseLength">Course length:</label>
          <input type="text" id="courseLength" size="2" maxLength="2" />
          <button onclick="setLength()">Set</button>
          <button onclick="resetLength()">Reset</button>
        </form>
      </div>
      <div>
        <label for="callReset">Current calling:</label>
        <button id="callReset" onclick="resetCalls()">Reset</button>
      </div>
      <div>
        Saved calling:
        <div id="savedCalling"></div>
        <button id="saveCalling" onclick="saveCalling()">Save</button>
        <button id="loadCalling" onclick="loadCalling()">Load</button>
      </div>
    </div>
    <div id="touch">
      <form onsubmit="return false">
        <button onclick="insertCourse()">Insert</button>
        <button onclick="pasteCourse()">Paste</button>
        <button onclick="copyCourse()">Copy</button>
        <button onclick="cutCourse()">Cut</button>
        <button onclick="deleteCourse()">Delete</button>
      </form>
      <select id="courses" size="2" ondblclick="copyCourse()"></select>
      <form onsubmit="return false">
        <button onclick="insertCourse()">Insert</button>
        <button onclick="pasteCourse()">Paste</button>
        <button onclick="copyCourse()">Copy</button>
        <button onclick="cutCourse()">Cut</button>
        <button onclick="deleteCourse()">Delete</button>
      </form>
    </div>
    <script type="text/javascript">
        var stage,             // Stage we're pricking on
            defaultInitialRow, // Start from rounds
            initialRow,        // Current start
            sixes,             // Number of sixes
            course,            // The course itself
            savedCourse,       // Course being saved for later
            touch,             // Touch being composed
            i,                 // Generic counter
            element;           // Generic HTML element

        for (i = 7; i <= 15; i = i + 2) {
            element = document.createElement('option');
            element.value = i;
            element.innerText = Pricker.Stage[i];
            document.getElementById('stage').appendChild(element);
            if (i === Pricker.Stage.Cinques) {
                document.getElementById('stage').value = i;
            }
        }

        function setStage() {
            'use strict';
            stage = parseInt(document.getElementById('stage').value);
            defaultInitialRow = Pricker.rowFromString('231', stage);
            initialRow = defaultInitialRow;
            sixes = stage * 2;
            course = new Pricker.Course(initialRow);
            savedCourse = null;
            touch = new Pricker.Touch(defaultInitialRow);
            reDraw();
        }

        function reDraw() {
            'use strict';

            var pricker = new Pricker.Output.Layout.Pricker(),
                calling = new Pricker.Output.Layout.Calling(),
                mbd = new Pricker.Output.Format.Mbd(),
                text = new Pricker.Output.Format.Text();

            document.getElementById('sixends').innerHTML =
                '<u>'
                + Pricker.stringFromRow(initialRow)
                + '</u>'
                + '<br />'
                + pricker.print(course, mbd)
                + '<br />';

            document.getElementById('calling').innerHTML =
                '<u>'
                + Pricker.stringFromRow(course.getInitialRow())
                + '</u>'
                + '<br />'
                + calling.print(course, text);

            course.setInitialRow(defaultInitialRow);
            document.getElementById('callingFromRounds').innerHTML =
                '<u>'
                + Pricker.stringFromRow(course.getInitialRow())
                + '</u>'
                + '<br />'
                + calling.print(course, text);
            course.setInitialRow(initialRow);

            document.getElementById('initialRow').value =
                Pricker.stringFromRow(initialRow);

            document.getElementById('courseLength').value = sixes;

            if (savedCourse) {
                document.getElementById('savedCalling').innerHTML =
                    '<u>'
                    + Pricker.stringFromRow(savedCourse.getInitialRow())
                    + '</u>'
                    + '<br />'
                    + calling.print(savedCourse, text);
            } else {
                document.getElementById('savedCalling').innerText = 'None';
            }

            // Touch display
            document.getElementById('courses').innerText = '';
            document.getElementById('courses').size = Math.max(
                touch.getLength() + 1,
                2
            );

            // Starting row
            element = document.createElement('option');
            element.value = 0;
            element.innerText = Pricker.stringFromRow(defaultInitialRow);
            document.getElementById('courses').appendChild(element);

            // Courses
            for (i = 1; i <= touch.getLength(); i++) {
                element = document.createElement('option');
                element.value = i;
                element.innerText = calling.print(touch.getCourse(i), text);
                document.getElementById('courses').appendChild(element);
            }
        }

        function c(six) {
            'use strict';
            course.getSix(six).toggleCall();
            reDraw();
        }

        function setInitialRow() {
            'use strict';
            try {
                initialRow = Pricker.rowFromString(
                    document.getElementById('initialRow').value,
                    stage
                );
                course.setInitialRow(initialRow);
            } catch (e) {
                // Ignore attempted change
            }

            reDraw();
        }

        function resetInitialRow() {
            'use strict';
            initialRow = defaultInitialRow;
            course.setInitialRow(initialRow);
            reDraw();
        }

        function setLength() {
            'use strict';
            sixes = parseInt(document.getElementById('courseLength').value);
            course.safeSetLength(sixes);
            sixes = course.getLength();
            reDraw();
        }

        function resetLength() {
            'use strict';
            sixes = stage * 2;
            course.setLength(sixes);
            reDraw();
        }

        function resetCalls() {
            'use strict';
            course = new Pricker.Course(initialRow);
            course.setLength(sixes);
            reDraw();
        }

        function saveCalling() {
            'use strict';
            savedCourse = course.clone();
            savedCourse.setInitialRow(defaultInitialRow);
            reDraw();
        }

        function loadCalling() {
            'use strict';
            course = savedCourse.clone();
            course.setInitialRow(initialRow);
            reDraw();
        }

        function insertCourse() {
            'use strict';
            var index = parseInt(document.getElementById('courses').value) || 0;
            touch.insertCourse(index + 1, course.clone());
            reDraw();
            document.getElementById('courses').value = index + 1;
        }

        function pasteCourse() {
            'use strict';
            var index = parseInt(document.getElementById('courses').value);
            deleteCourse();
            document.getElementById('courses').value = index - 1;
            insertCourse();
        }

        function copyCourse() {
            'use strict';
            var index = parseInt(document.getElementById('courses').value) || 0;
            if (index) {
                course = touch.getCourse(index).clone();
                initialRow = course.getInitialRow();
                sixes = course.getLength();
                reDraw();
            }
        }

        function cutCourse() {
            'use strict';
            copyCourse();
            deleteCourse();
        }

        function deleteCourse() {
            'use strict';
            var index = parseInt(document.getElementById('courses').value) || 0;
            if (index) {
                touch.deleteCourse(index);
                reDraw();
                document.getElementById('courses').value = index;
            }
        }

        setStage();
    </script>
  </body>
</html>
